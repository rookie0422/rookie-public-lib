



# 二、通信接口

## 1. UART

### 1.1 工作原理

​	两个uart之间相互通信，将 并行数据转化为串行数据进行传输，需要两根通信线 Tx Rx 两个uart之间交叉相连 

​	Tx1 <----> Rx2

​	Rx1 <----> Tx1

![](D:\stm103\my_note\嵌入式知识点\uart连接图.png)

​	串口通信属于 异步通信 不需要时钟线同步信号。

​	会在数据包中添加 开始位 停止位

​	帧格式 ： 起始位 数据帧 校验位 停止位

### 1.2 优缺点

#### 	1.2.1 优点

​		仅需两根通讯线

​		异步通信，无需时钟信号

​		具有奇偶校验位，有纠错空间

​		只需要收发双方设定好 数据包的结构

#### 	1.2.2 缺点

​		数据帧最大为9位

​		不支持从属系统或多个系统

​		接受双方波特率要对应相等

## 2. SPI

### 2.1 工作原理

在SPI设备中，设备分为主机控制设备（通常是微控制器）和从机（通常是传感器，显示器和存储芯片）设备，从机从主机那获取指令。

**SPI信号线有四种：**

MOSI-信号线：主机输出，从机输入；
MISO-信号线：主机输入，从机输出；
SCLK-时钟信号；
SS/CS-片选信号；

### 2.2 通信步骤

1.主机输出时钟信号



2.主机拉低SS/CS引脚，激活从机



3.主机通过MOSI将数据发送给从机



4.如果需要相应，则从机通过MISO将数据返回给从机



### 2.3 工作模式

SPI支持多种工作模式，这些模式决定了时钟信号和数据传输的时序关系。SPI的工作模式由两个参数决定：

1. **时钟极性（CPOL，Clock Polarity）**: 决定时钟信号的空闲电平是高电平还是低电平。
2. **时钟相位（CPHA，Clock Phase）**: 决定数据是在时钟的第一个边沿（上升或下降）采样，还是第二个边沿采样。

#### 2.3.1 4 种工作模式

SPI工作模式可以用CPOL和CPHA的组合表示，总共有4种组合方式，分别是模式0、模式1、模式2和模式3：

| **模式**  | **CPOL** | **CPHA** | **时钟空闲电平** | **数据采样边沿** |
| --------- | -------- | -------- | ---------------- | ---------------- |
| **模式0** | 0        | 0        | 低电平           | 上升沿采样       |
| **模式1** | 0        | 1        | 低电平           | 下降沿采样       |
| **模式2** | 1        | 0        | 高电平           | 下降沿采样       |
| **模式3** | 1        | 1        | 高电平           | 上升沿采样       |



#### 2.3.2 详细解释

- **CPOL = 0**：时钟信号在空闲时为低电平，数据传输时，时钟从低电平开始转换。
- **CPOL = 1**：时钟信号在空闲时为高电平，数据传输时，时钟从高电平开始转换。
- **CPHA = 0**：数据在时钟的第一个边沿（上升沿或下降沿）采样。
- **CPHA = 1**：数据在时钟的第二个边沿采样。



### 2.4优缺点

#### 2.4.1 优点

无起始位和停止位，因此数据可以持续传输不会中断；

数据传输速率快（比IIC快几乎两倍）；

独立的MISO、MOSI可以同时发送和接收数据。

#### 2.4.2 缺点

使用四根线（IIC使用两根线）

没有信号接收成功的确认（IIC由此功能）

没有任何形式的错误检查（UART中的奇偶校验位）

## 3. IIC

### 3.1 工作原理

串行通信协议，需要时钟同步信号并且由主机控制。

半双工通信，可以将多个从机连接到单个主机（如SPI），也可以多个主机控制一个或多个从机。

两根信号线 SDA–数据线 SCL–时钟线

IIC的数据传输是以多个msg的形式进行。

每个msg包括：从机二进制地址帧、以及一个或者多个数据帧、开始条件和停止条件，读/写位和数据帧之间的ACK/NACK位：

![](D:\stm103\my_note\嵌入式知识点\IICmsg格式.png)

![](D:\stm103\my_note\嵌入式知识点\IIC通信电平.png)

​		

**启动条件：当SCL为高电平时，`SDA`从`高电平`向`低电平`切换**

**停止条件：当SCL是高电平时，`SDA`由`低电平`向`高电平`切换**

### 3.2 通信步骤

1.在SCL线为高电平时，主机通过将SDA线从高电平切换到低电平来启动总线通信。
2.主机向总线发送要与之通信的从机的7位或10位地址，以及读/写位
3.每个从机将主机发送的地址与其自己的地址进行比较。如果地址匹配，则从机通过将SDA线拉低一位返回一个ACK位。如果主机的地址与从机的地址不匹配，则从机将SDA线拉高。
4.主机发送或接收数据帧；
5.传输完每个数据帧后，接收设备将另一个ACK位返回给发送方，以确认已成功接收到该帧；
6.随后主机将SCL切换为高电平，然后再将SDA切换为高电平，从而向从机发送停止条件。

### 3.3 优缺点

#### 3.3.1 优点

1.仅仅使用两根线
2.支持多个主机和从机
3.硬件比UART更简单

#### 3.3.2 缺点

1.数据传输比SPI慢
2.数据帧大小限制为8位



